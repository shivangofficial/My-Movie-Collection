<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Movie Collection â€” Letterboxd Style</title>

  <!-- Google Fonts for Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#14181c; /* Letterboxd dark background */
      --card:#1f262d; /* Slightly lighter for inputs/modals */
      --muted:#99aabb;
      --accent:#00e054; /* Classic green accent */
      --accent-hover:#00b042;
      --danger: #ff5f5f;
      --glass: rgba(255,255,255,0.08);
      --border: rgba(255,255,255,0.1);
      --radius:6px; 
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color:#fff;
      -webkit-font-smoothing:antialiased;
      padding: 0;
    }

    /* Layout Wrapper */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 24px;
    }

    /* Header */
    header{
      display:flex;
      flex-wrap: wrap;
      gap:20px;
      align-items:flex-end;
      justify-content:space-between;
      margin-bottom:32px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 20px;
    }
    .title h1{
        margin:0;
        font-size:24px;
        font-weight: 700;
        letter-spacing: -0.02em;
    }
    .title p{
        margin:4px 0 0 0;
        color:var(--muted);
        font-size:14px;
    }

    /* Controls */
    .controls{display:flex;gap:12px;align-items:center; flex-wrap: wrap;}
    
    .search-wrapper {
        position: relative;
    }
    .search{
      background: #2c3440;
      border:1px solid transparent;
      padding:10px 14px;
      border-radius: 20px; /* Pill shape */
      color: #fff;
      width:200px;
      font-size: 14px;
      outline:none;
      transition: all .2s;
    }
    .search:focus{
        background: #fff;
        color: #14181c;
    }
    .search::placeholder {
        color: var(--muted);
    }

    .btn{
      background: #456;
      border:none;
      color:#fff;
      padding:10px 16px;
      border-radius:4px;
      cursor:pointer;
      font-size:13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: background 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn:hover { background: #567; }
    
    .btn.primary{
      background: var(--accent);
      color:#14181c;
    }
    .btn.primary:hover {
        background: var(--accent-hover);
    }

    .btn.danger{
        background: transparent;
        color: var(--danger);
        border: 1px solid rgba(255, 95, 95, 0.3);
    }
    .btn.danger:hover{
        background: var(--danger);
        color: #fff;
    }
    
    /* AI Buttons */
    .btn.ai-roast {
        background: linear-gradient(135deg, #ff8000, #ff0055);
        color: white;
    }
    .btn.ai-roast:hover { filter: brightness(1.1); }

    .btn.ai-suggest {
        background: linear-gradient(135deg, #40bcf4, #00e054);
        color: #0b1220;
    }
    .btn.ai-suggest:hover { filter: brightness(1.1); }


    /* Grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 24px 16px; 
      align-items:start;
    }

    /* Movie Card */
    .card{
      position: relative;
      border-radius: var(--radius);
      transition: transform 0.2s;
      cursor: pointer;
      group: 'card';
    }
    .card:hover{ 
        transform: translateY(-4px); 
    }

    /* Poster Frame */
    .poster-frame {
        position: relative;
        border-radius: var(--radius);
        overflow: hidden;
        aspect-ratio: 2 / 3;
        box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        border: 1px solid rgba(255,255,255,0.1);
        background: #232a32;
    }
    
    /* Hover Overlay on Poster */
    .poster-overlay {
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0.6);
        opacity: 0;
        transition: opacity 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(2px);
    }
    .card:hover .poster-overlay {
        opacity: 1;
    }

    .poster{
      width:100%;
      height: 100%;
      object-fit:cover;
      display:block;
    }

    .card-actions {
        display: flex;
        gap: 12px;
        color: #fff;
        font-weight: 600;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Meta Data (Below poster) */
    .meta{
      padding-top: 8px;
    }
    .title-row{
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2px;
      line-height: 1.3;
    }
    .movie-title {
        font-weight: 600;
        font-size: 15px;
        color: #fff;
        text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    }
    .year {
        color: var(--muted);
        font-size: 13px;
        margin-top: 2px;
    }
    .rating-row {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 6px;
        font-size: 13px;
        color: var(--accent);
    }
    .stars {
        display: inline-flex;
    }

    /* Modal */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(4px);
        display: none;
        place-items: center;
        z-index: 100;
        padding: 20px;
    }
    .modal-overlay.active { display: grid; }
    
    .modal {
        background: #232a32;
        padding: 24px;
        border-radius: 8px;
        width: 100%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        border: 1px solid var(--border);
        color: #d8e0e8;
    }
    .modal h2 { margin-top: 0; font-size: 18px; margin-bottom: 20px; color: #fff; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
    
    /* Form Grid */
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }
    .form-full {
        grid-column: 1 / -1;
    }

    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; font-weight: 600; }
    .form-group input, .form-group select {
        width: 100%;
        background: #14181c;
        border: 1px solid #456;
        padding: 10px;
        color: white;
        border-radius: 4px;
        font-family: inherit;
    }
    .form-group input:focus { border-color: var(--accent); outline: none; }
    
    .modal-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 24px;
        padding-top: 16px;
        border-top: 1px solid var(--border);
    }
    .action-right {
        display: flex;
        gap: 10px;
    }

    /* AI Modal Specifics */
    #aiContent {
        line-height: 1.6;
        font-size: 15px;
        white-space: pre-wrap; /* Preserve line breaks */
    }
    .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
        margin-right: 8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Empty State */
    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 60px;
        color: var(--muted);
    }

    /* Responsive */
    @media (max-width: 768px) {
        header { flex-direction: column; align-items: stretch; gap: 16px; }
        .controls { flex-direction: column; align-items: stretch; }
        .search { width: 100%; }
        .grid { grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .title h1 { font-size: 20px; }
        .btn { justify-content: center; }
        .form-grid { grid-template-columns: 1fr; }
    }
    @media (max-width: 400px) {
        .grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <div class="title">
      <h1>CineLog</h1>
      <p>A personal collection of 48 films</p>
    </div>
    
    <div class="controls">
      <div class="search-wrapper">
        <input type="text" id="searchInput" class="search" placeholder="Filter by name, genre..." />
      </div>
      <!-- New Gemini AI Buttons -->
      <button class="btn ai-roast" onclick="generateRoast()">âœ¨ Roast My Taste</button>
      <button class="btn ai-suggest" onclick="generateRecommendation()">âœ¨ Suggest a Gem</button>
      
      <button class="btn primary" onclick="openAddModal()">+ Log Film</button>
    </div>
  </header>

  <main id="grid" class="grid">
    <!-- Cards injected here -->
  </main>
</div>

<!-- Edit/Add Movie Modal -->
<div id="entryModal" class="modal-overlay">
    <div class="modal">
        <h2 id="modalTitle">Log a Film</h2>
        <form id="entryForm" onsubmit="handleSave(event)">
            <input type="hidden" name="id">
            
            <div class="form-grid">
                <div class="form-group form-full">
                    <label>Film Title</label>
                    <input type="text" name="title" required placeholder="e.g. Parasite" autocomplete="off">
                </div>
                
                <div class="form-group">
                    <label>Director</label>
                    <input type="text" name="director" placeholder="e.g. Bong Joon-ho">
                </div>

                <div class="form-group">
                    <label>Writer</label>
                    <input type="text" name="writer" placeholder="e.g. Bong Joon-ho">
                </div>

                <div class="form-group">
                    <label>Release Date</label>
                    <input type="date" name="releaseDate">
                </div>

                <div class="form-group">
                    <label>Genre</label>
                    <input type="text" name="genre" placeholder="e.g. Thriller, Drama">
                </div>

                <div class="form-group form-full">
                    <label>Poster Image URL</label>
                    <input type="url" name="posterUrl" placeholder="https://example.com/poster.jpg">
                </div>

                <div class="form-group form-full">
                    <label>Rating</label>
                    <select name="rating">
                        <option value="5">â˜…â˜…â˜…â˜…â˜… - Masterpiece</option>
                        <option value="4">â˜…â˜…â˜…â˜… - Great</option>
                        <option value="3">â˜…â˜…â˜… - Good</option>
                        <option value="2">â˜…â˜… - Fair</option>
                        <option value="1">â˜… - Poor</option>
                    </select>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" id="deleteBtn" class="btn danger" onclick="handleDelete()" style="display:none;">Delete Film</button>
                <div class="action-right">
                    <button type="button" class="btn" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn primary">Save Entry</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- AI Output Modal -->
<div id="aiModal" class="modal-overlay">
    <div class="modal">
        <h2 id="aiTitle">Gemini Analysis</h2>
        <div id="aiContent">Thinking...</div>
        <div class="modal-actions">
            <div></div>
            <button type="button" class="btn" onclick="closeAiModal()">Close</button>
        </div>
    </div>
</div>

<script>
  // API Key for Gemini
  const apiKey = ""; 

  // Initial Mock Data with Extended Fields
  const initialMovies = [
    { id: 1, title: "Blade Runner 2049", year: 2017, releaseDate: "2017-10-06", director: "Denis Villeneuve", writer: "Hampton Fancher", genre: "Sci-Fi", rating: 5, color: "#f97316", posterUrl: "" },
    { id: 2, title: "Dune: Part Two", year: 2024, releaseDate: "2024-03-01", director: "Denis Villeneuve", writer: "Denis Villeneuve", genre: "Sci-Fi", rating: 5, color: "#d97706", posterUrl: "" },
    { id: 3, title: "Interstellar", year: 2014, releaseDate: "2014-11-07", director: "Christopher Nolan", writer: "Jonathan Nolan", genre: "Sci-Fi", rating: 5, color: "#0ea5e9", posterUrl: "" },
    { id: 4, title: "The Grand Budapest Hotel", year: 2014, releaseDate: "2014-03-28", director: "Wes Anderson", writer: "Wes Anderson", genre: "Comedy", rating: 4, color: "#ec4899", posterUrl: "" },
    { id: 5, title: "Arrival", year: 2016, releaseDate: "2016-11-11", director: "Denis Villeneuve", writer: "Eric Heisserer", genre: "Sci-Fi", rating: 5, color: "#64748b", posterUrl: "" },
    { id: 6, title: "Whiplash", year: 2014, releaseDate: "2014-10-10", director: "Damien Chazelle", writer: "Damien Chazelle", genre: "Drama", rating: 5, color: "#eab308", posterUrl: "" },
    { id: 7, title: "La La Land", year: 2016, releaseDate: "2016-12-09", director: "Damien Chazelle", writer: "Damien Chazelle", genre: "Musical", rating: 4, color: "#6366f1", posterUrl: "" },
    { id: 8, title: "Everything Everywhere All At Once", year: 2022, releaseDate: "2022-03-25", director: "Daniels", writer: "Daniels", genre: "Action", rating: 5, color: "#8b5cf6", posterUrl: "" },
    { id: 9, title: "Her", year: 2013, releaseDate: "2013-12-18", director: "Spike Jonze", writer: "Spike Jonze", genre: "Romance", rating: 4, color: "#f43f5e", posterUrl: "" },
    { id: 10, title: "Parasite", year: 2019, releaseDate: "2019-11-08", director: "Bong Joon-ho", writer: "Bong Joon-ho", genre: "Thriller", rating: 5, color: "#10b981", posterUrl: "" },
  ];

  let movies = [...initialMovies];
  let currentDeleteId = null;

  const grid = document.getElementById('grid');
  const searchInput = document.getElementById('searchInput');
  const modal = document.getElementById('entryModal');
  const entryForm = document.getElementById('entryForm');
  const modalTitle = document.getElementById('modalTitle');
  const deleteBtn = document.getElementById('deleteBtn');
  
  const aiModal = document.getElementById('aiModal');
  const aiContent = document.getElementById('aiContent');
  const aiTitle = document.getElementById('aiTitle');

  // --- Gemini API Handler ---
  async function callGemini(promptText) {
      try {
          const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                  contents: [{
                      parts: [{ text: promptText }]
                  }]
              })
          });

          if (!response.ok) throw new Error('API call failed');
          
          const data = await response.json();
          return data.candidates[0].content.parts[0].text;
      } catch (error) {
          console.error("Gemini Error:", error);
          return "Sorry, I couldn't reach the AI film critic right now. Please try again later.";
      }
  }

  // --- AI Feature 1: Roast My Taste ---
  async function generateRoast() {
      openAiModal("Roasting Your Taste...", "Analyzing your pretentious list of films...");
      const movieList = movies.map(m => `${m.title} (${m.rating}/5 stars, ${m.genre})`).join(", ");
      const prompt = `
        I am going to give you a list of movies I have watched and rated. 
        Act as a snarky, pretentious film critic or a stereotypical Letterboxd user.
        Roast my movie taste based on these films. Be funny, slightly mean, but ultimately harmless. 
        Keep it under 150 words.
        
        My Films:
        ${movieList}
      `;
      const result = await callGemini(prompt);
      updateAiModal("The Verdict ðŸ”¥", result);
  }

  // --- AI Feature 2: Recommendation ---
  async function generateRecommendation() {
      openAiModal("Finding a Gem...", "Sifting through the archives for something you'll love...");
      const favorites = movies.filter(m => m.rating >= 4).map(m => m.title).join(", ");
      const prompt = `
        Here is a list of movies I love: ${favorites}.
        Based on this specific taste, suggest exactly ONE "Hidden Gem" movie that I likely haven't seen.
        Do not suggest mainstream blockbusters (like Marvel, Christopher Nolan, or Denis Villeneuve films). 
        Suggest something slightly more niche, indie, or international that fits the vibe of my favorites.
        
        Format the response exactly like this:
        **Title:** [Movie Title] ([Year])
        **Why:** [One sentence explaining why it fits my taste]
      `;
      const result = await callGemini(prompt);
      updateAiModal("Recommended Watch âœ¨", result);
  }

  // --- AI UI Helpers ---
  function openAiModal(title, initialText) {
      aiModal.classList.add('active');
      aiTitle.textContent = title;
      aiContent.innerHTML = `<div class="loading-spinner"></div> ${initialText}`;
  }

  function updateAiModal(title, text) {
      aiTitle.textContent = title;
      const formatted = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
      aiContent.innerHTML = formatted;
  }

  function closeAiModal() {
      aiModal.classList.remove('active');
  }
  
  aiModal.addEventListener('click', (e) => {
    if (e.target === aiModal) closeAiModal();
  });

  // --- Core CRUD Logic ---

  function renderMovies(list) {
    grid.innerHTML = '';
    
    if (list.length === 0) {
        grid.innerHTML = `<div class="empty-state">No films found matching your search.</div>`;
        document.querySelector('.title p').textContent = `A personal collection of 0 films`;
        return;
    }

    list.forEach(movie => {
        const card = document.createElement('div');
        card.className = 'card';
        card.onclick = () => openEditModal(movie.id); // Click to edit
        
        const stars = 'â˜…'.repeat(movie.rating) + 'â˜†'.repeat(5 - movie.rating);
        
        // Use poster URL if provided, otherwise generate placeholder
        let imageSrc;
        if(movie.posterUrl && movie.posterUrl.trim() !== "") {
            imageSrc = movie.posterUrl;
        } else {
             // Fallback SVG
             imageSrc = `data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='300' viewBox='0 0 200 300'%3E%3Crect width='200' height='300' fill='${encodeURIComponent(movie.color)}'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='20' fill='rgba(255,255,255,0.8)'%3E${encodeURIComponent(movie.title.substring(0,1))}%3C/text%3E%3C/svg%3E`;
        }

        card.innerHTML = `
            <div class="poster-frame">
                <img src="${imageSrc}" alt="${movie.title}" class="poster" loading="lazy" onerror="this.onerror=null;this.src='https://via.placeholder.com/200x300?text=Error'">
                <div class="poster-overlay">
                    <div class="card-actions">
                        Edit Entry
                    </div>
                </div>
            </div>
            <div class="meta">
                <div class="title-row">
                    <span class="movie-title">${movie.title}</span>
                </div>
                <div class="year">${movie.year} â€¢ ${movie.director || 'Unknown'}</div>
                <div class="rating-row">
                    <span class="stars">${stars}</span>
                </div>
            </div>
        `;
        grid.appendChild(card);
    });
    
    document.querySelector('.title p').textContent = `A personal collection of ${list.length} films`;
  }

  // --- Modal Logic (Add & Edit) ---

  function openAddModal() {
      modal.classList.add('active');
      entryForm.reset();
      document.querySelector('input[name="id"]').value = ""; // Clear ID
      modalTitle.textContent = "Log a New Film";
      deleteBtn.style.display = "none"; // Hide delete button
      document.querySelector('input[name="title"]').focus();
  }

  function openEditModal(id) {
      const movie = movies.find(m => m.id === id);
      if (!movie) return;

      modal.classList.add('active');
      modalTitle.textContent = "Edit Film Details";
      deleteBtn.style.display = "block"; // Show delete button
      currentDeleteId = id;

      // Populate Form
      const f = entryForm.elements;
      f['id'].value = movie.id;
      f['title'].value = movie.title;
      f['director'].value = movie.director || "";
      f['writer'].value = movie.writer || "";
      f['releaseDate'].value = movie.releaseDate || "";
      f['genre'].value = movie.genre || "";
      f['posterUrl'].value = movie.posterUrl || "";
      f['rating'].value = movie.rating;
  }

  function closeModal() {
      modal.classList.remove('active');
      entryForm.reset();
      currentDeleteId = null;
  }

  // Handle Save (Create or Update)
  function handleSave(e) {
    e.preventDefault();
    const formData = new FormData(entryForm);
    const id = formData.get('id');

    // Basic data collection
    const entryData = {
        title: formData.get('title'),
        director: formData.get('director'),
        writer: formData.get('writer'),
        genre: formData.get('genre'),
        releaseDate: formData.get('releaseDate'),
        posterUrl: formData.get('posterUrl'),
        rating: parseInt(formData.get('rating')),
        year: formData.get('releaseDate') ? new Date(formData.get('releaseDate')).getFullYear() : new Date().getFullYear()
    };

    if (id) {
        // UPDATE existing
        const index = movies.findIndex(m => m.id == id);
        if (index !== -1) {
            // Keep existing color if not changed
            entryData.id = parseInt(id);
            entryData.color = movies[index].color; 
            movies[index] = entryData;
        }
    } else {
        // CREATE new
        entryData.id = Date.now();
        // Random color for placeholder
        const colors = ["#ef4444", "#f97316", "#f59e0b", "#84cc16", "#10b981", "#06b6d4", "#3b82f6", "#6366f1", "#8b5cf6", "#d946ef", "#f43f5e"];
        entryData.color = colors[Math.floor(Math.random() * colors.length)];
        movies.unshift(entryData);
    }

    renderMovies(movies);
    closeModal();
  }

  // Handle Delete
  function handleDelete() {
      if (currentDeleteId && confirm("Are you sure you want to delete this film from your collection?")) {
          movies = movies.filter(m => m.id !== currentDeleteId);
          renderMovies(movies);
          closeModal();
      }
  }

  // Search
  searchInput.addEventListener('input', (e) => {
    const term = e.target.value.toLowerCase();
    const filtered = movies.filter(m => 
        m.title.toLowerCase().includes(term) || 
        (m.genre && m.genre.toLowerCase().includes(term)) ||
        (m.director && m.director.toLowerCase().includes(term))
    );
    renderMovies(filtered);
  });

  // Close modal on outside click
  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });

  // Initial Render
  renderMovies(movies);

</script>
</body>
</html>
